
<!doctype html>
<html lang="en" class="no-js">
  <head>

      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">




        <link rel="prev" href="../installation/">


        <link rel="next" href="../model_format/">

      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.19">



        <title>Walkthrough - Simple Server Framework (SSF)</title>



      <link rel="stylesheet" href="../assets/stylesheets/main.eebd395e.min.css">


        <link rel="stylesheet" href="../assets/stylesheets/palette.ecc896b0.min.css">









        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>



    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>






  </head>









    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="purple">



      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>

    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">


        <a href="#walkthrough" class="md-skip">
          Skip to content
        </a>

    </div>
    <div data-md-component="announce">

    </div>






<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Simple Server Framework (SSF)" class="md-header__button md-logo" aria-label="Simple Server Framework (SSF)" data-md-component="logo">


  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Simple Server Framework (SSF)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">

              Walkthrough

          </span>
        </div>
      </div>
    </div>


        <form class="md-header__option" data-md-component="palette">




            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">

              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>





            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">

              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>


        </form>




      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">

        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>

    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>


      <div class="md-header__source">
        <a href="https://github.com/graphcore/simple-server-framework" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>

  </nav>

</header>

    <div class="md-container" data-md-component="container">






      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">



              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Simple Server Framework (SSF)" class="md-nav__button md-logo" aria-label="Simple Server Framework (SSF)" data-md-component="logo">


  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Simple Server Framework (SSF)
  </label>

    <div class="md-nav__source">
      <a href="https://github.com/graphcore/simple-server-framework" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>

  <ul class="md-nav__list" data-md-scrollfix>








    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        What is SSF?
      </a>
    </li>










    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        Quick start
      </a>
    </li>










    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        Installation
      </a>
    </li>












    <li class="md-nav__item md-nav__item--active">

      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">





        <label class="md-nav__link md-nav__link--active" for="__toc">
          Walkthrough
          <span class="md-nav__icon md-icon"></span>
        </label>

      <a href="./" class="md-nav__link md-nav__link--active">
        Walkthrough
      </a>



<nav class="md-nav md-nav--secondary" aria-label="Table of contents">






    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>

        <li class="md-nav__item">
  <a href="#select-a-model" class="md-nav__link">
    Select a model
  </a>

</li>

        <li class="md-nav__item">
  <a href="#implement-the-application-interface" class="md-nav__link">
    Implement the application interface
  </a>

</li>

        <li class="md-nav__item">
  <a href="#write-ssf-config" class="md-nav__link">
    Write SSF config
  </a>

</li>

        <li class="md-nav__item">
  <a href="#use-ssf" class="md-nav__link">
    Use SSF
  </a>

    <nav class="md-nav" aria-label="Use SSF">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#example-1" class="md-nav__link">
    Example 1
  </a>

</li>

          <li class="md-nav__item">
  <a href="#example-2" class="md-nav__link">
    Example 2
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#discussion-example-1-vs-example-2" class="md-nav__link">
    Discussion: Example 1 vs Example 2
  </a>

    <nav class="md-nav" aria-label="Discussion: Example 1 vs Example 2">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#example-1-gives-you-more-control" class="md-nav__link">
    Example 1 gives you more control:
  </a>

</li>

          <li class="md-nav__item">
  <a href="#example-2-is-quicker-but-can-have-some-runtime-impact" class="md-nav__link">
    Example 2 is quicker but can have some runtime impact:
  </a>

</li>

      </ul>
    </nav>

</li>

    </ul>

</nav>

    </li>










    <li class="md-nav__item">
      <a href="../model_format/" class="md-nav__link">
        Model format
      </a>
    </li>










    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        CLI Usage
      </a>
    </li>










    <li class="md-nav__item">
      <a href="../all_options/" class="md-nav__link">
        Options
      </a>
    </li>










    <li class="md-nav__item">
      <a href="../features/" class="md-nav__link">
        Features
      </a>
    </li>










    <li class="md-nav__item">
      <a href="../advanced/" class="md-nav__link">
        Advanced
      </a>
    </li>



  </ul>
</nav>
                  </div>
                </div>
              </div>



              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">






    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>

        <li class="md-nav__item">
  <a href="#select-a-model" class="md-nav__link">
    Select a model
  </a>

</li>

        <li class="md-nav__item">
  <a href="#implement-the-application-interface" class="md-nav__link">
    Implement the application interface
  </a>

</li>

        <li class="md-nav__item">
  <a href="#write-ssf-config" class="md-nav__link">
    Write SSF config
  </a>

</li>

        <li class="md-nav__item">
  <a href="#use-ssf" class="md-nav__link">
    Use SSF
  </a>

    <nav class="md-nav" aria-label="Use SSF">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#example-1" class="md-nav__link">
    Example 1
  </a>

</li>

          <li class="md-nav__item">
  <a href="#example-2" class="md-nav__link">
    Example 2
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#discussion-example-1-vs-example-2" class="md-nav__link">
    Discussion: Example 1 vs Example 2
  </a>

    <nav class="md-nav" aria-label="Discussion: Example 1 vs Example 2">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#example-1-gives-you-more-control" class="md-nav__link">
    Example 1 gives you more control:
  </a>

</li>

          <li class="md-nav__item">
  <a href="#example-2-is-quicker-but-can-have-some-runtime-impact" class="md-nav__link">
    Example 2 is quicker but can have some runtime impact:
  </a>

</li>

      </ul>
    </nav>

</li>

    </ul>

</nav>
                  </div>
                </div>
              </div>



            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">







<!-- Copyright (c) 2023 Graphcore Ltd. All rights reserved. -->
<h1 id="walkthrough">Walkthrough</h1>
<p>This walkthrough will show how to serve an application using SSF and deploy it on Gcore to use IPUs.
As a prerequisite we need to follow the <a href="../installation/">installation instructions</a> to install and enable the Poplar SDK with Poptorch in the environment.</p>
<h2 id="select-a-model">Select a model</h2>
<p>For this example we deploy a pre-trained question answering model from Huggingface.
<a href="https://huggingface.co/distilbert-base-cased-distilled-squad">Distilbert-base-cased-distilled-squad</a> will do the trick ðŸ¤—<br />
The model itself can be imported from the <a href="https://github.com/huggingface/optimum-graphcore">optimum-graphcore</a> library as an inference pipeline:
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span> <span class="nn">optimum.graphcore</span> <span class="kn">import</span> <span class="n">pipeline</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="n">question_answerer</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="s2">&quot;question-answering&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;distilbert-base-cased-distilled-squad&quot;</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">)</span>
</span></code></pre></div>
Note that the input is a dictionary containing <code>question</code> and <code>context</code> strings.
The output is also a dictionary containing an <code>answer</code> string, the <code>score</code>, and the <code>start</code> and <code>end</code> positions of the answer in the <code>context</code> string.</p>
<h2 id="implement-the-application-interface">Implement the application interface</h2>
<p>To interface our model with SSF we need to implement the application interface  <a href="../model_format/#create-an-application-interface"><code>SSFApplicationInterface</code></a>.
The following file <code>my_app.py</code> shows the code needed for this:
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">from</span> <span class="nn">optimum.graphcore</span> <span class="kn">import</span> <span class="n">pipeline</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="kn">import</span> <span class="nn">logging</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="kn">from</span> <span class="nn">ssf.application</span> <span class="kn">import</span> <span class="n">SSFApplicationInterface</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="kn">from</span> <span class="nn">ssf.utils</span> <span class="kn">import</span> <span class="n">get_ipu_count</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="kn">from</span> <span class="nn">ssf.results</span> <span class="kn">import</span> <span class="n">RESULT_OK</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="k">class</span> <span class="nc">MyApplication</span><span class="p">(</span><span class="n">SSFApplicationInterface</span><span class="p">):</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">question_answerer</span><span class="p">:</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dummy_inputs_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>            <span class="s2">&quot;question&quot;</span><span class="p">:</span> <span class="s2">&quot;What is your name?&quot;</span><span class="p">,</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>            <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;My name is Rob.&quot;</span><span class="p">,</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>        <span class="p">}</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>        <span class="k">if</span> <span class="n">get_ipu_count</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Compiling model...&quot;</span><span class="p">)</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>            <span class="n">build_pipeline</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>                <span class="s2">&quot;question-answering&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;distilbert-base-cased-distilled-squad&quot;</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>            <span class="p">)</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>            <span class="n">build_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dummy_inputs_dict</span><span class="p">)</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a>                <span class="s2">&quot;IPU requirements not met on this device, skipping compilation.&quot;</span>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a>            <span class="p">)</span>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a>        <span class="k">return</span> <span class="n">RESULT_OK</span>
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a>
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a>
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a>    <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;App started&quot;</span><span class="p">)</span>
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">question_answerer</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span>
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a>            <span class="s2">&quot;question-answering&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;distilbert-base-cased-distilled-squad&quot;</span>
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a>        <span class="p">)</span>
</span><span id="__span-1-37"><a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">question_answerer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dummy_inputs_dict</span><span class="p">)</span>
</span><span id="__span-1-38"><a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a>        <span class="k">return</span> <span class="n">RESULT_OK</span>
</span><span id="__span-1-39"><a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a>
</span><span id="__span-1-40"><a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a>
</span><span id="__span-1-41"><a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a>    <span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">meta</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="__span-1-42"><a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">question_answerer</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</span><span id="__span-1-43"><a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="__span-1-44"><a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a>
</span><span id="__span-1-45"><a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a>
</span><span id="__span-1-46"><a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a>    <span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-1-47"><a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a>        <span class="k">return</span> <span class="n">RESULT_OK</span>
</span><span id="__span-1-48"><a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a>
</span><span id="__span-1-49"><a id="__codelineno-1-49" name="__codelineno-1-49" href="#__codelineno-1-49"></a>
</span><span id="__span-1-50"><a id="__codelineno-1-50" name="__codelineno-1-50" href="#__codelineno-1-50"></a>    <span class="k">def</span> <span class="nf">is_healthy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-1-51"><a id="__codelineno-1-51" name="__codelineno-1-51" href="#__codelineno-1-51"></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">question_answerer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dummy_inputs_dict</span><span class="p">)</span>
</span><span id="__span-1-52"><a id="__codelineno-1-52" name="__codelineno-1-52" href="#__codelineno-1-52"></a>        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Rob&quot;</span>
</span><span id="__span-1-53"><a id="__codelineno-1-53" name="__codelineno-1-53" href="#__codelineno-1-53"></a>
</span><span id="__span-1-54"><a id="__codelineno-1-54" name="__codelineno-1-54" href="#__codelineno-1-54"></a>
</span><span id="__span-1-55"><a id="__codelineno-1-55" name="__codelineno-1-55" href="#__codelineno-1-55"></a>
</span><span id="__span-1-56"><a id="__codelineno-1-56" name="__codelineno-1-56" href="#__codelineno-1-56"></a>
</span><span id="__span-1-57"><a id="__codelineno-1-57" name="__codelineno-1-57" href="#__codelineno-1-57"></a><span class="k">def</span> <span class="nf">create_ssf_application_instance</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">SSFApplicationInterface</span><span class="p">:</span>
</span><span id="__span-1-58"><a id="__codelineno-1-58" name="__codelineno-1-58" href="#__codelineno-1-58"></a>    <span class="k">return</span> <span class="n">MyApplication</span><span class="p">()</span>
</span></code></pre></div></p>
<p>Now let's explain this step-by-step.</p>
<p>SSF will serve an instance of <code>MyApplication</code> (by calling <code>create_ssf_application_instance</code>).
To implement the interface we need to define the 5 methods <code>build</code>, <code>startup</code>, <code>request</code>, <code>shutdown</code> and is <code>is_healthy</code>:</p>
<ul>
<li>In the <code>__init__</code> method we define a placeholder for the <code>question_answerer</code>. We also define a dummy input dictionary that will be used to test the pipeline.
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">class</span> <span class="nc">MyApplication</span><span class="p">(</span><span class="n">SSFApplicationInterface</span><span class="p">):</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">question_answerer</span><span class="p">:</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dummy_inputs_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>            <span class="s2">&quot;question&quot;</span><span class="p">:</span> <span class="s2">&quot;What is your name?&quot;</span><span class="p">,</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>            <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;My name is Rob.&quot;</span><span class="p">,</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>        <span class="p">}</span>
</span></code></pre></div></li>
<li>The <code>build</code> method is called when issuing <a href="../usage/#ssf-build">gc-ssf build</a>. It should contain any preliminary steps that we want to happen offline, before running the server.<br />
Since we are using IPUs, we can compile the model in advance to save time at server startup.<br />
To do that, we should call the <code>pipeline</code> object at least once (the first call triggers compilation). The IPU compilation generates a cache <code>exe_cache/</code>, we explain later how to package this cache alongside the server. HuggingFace libraries will also download and cache model weights.
We may not have access to IPUs to run the <code>build</code> step outside of our deployment environment - we can check this by using the utility function <code>get_ipu_count</code>. If we don't have access to IPUs it will skip compilation which will then be triggered by <code>startup</code> when deployed.<br />
Note: we use <code>return RESULT_OK</code> from <a href="../model_format/#optional-return-code">ssf return codes</a>, this is equivalent to <code>return 0</code>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>        <span class="k">if</span> <span class="n">get_ipu_count</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Compiling model...&quot;</span><span class="p">)</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>            <span class="n">build_pipeline</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>                <span class="s2">&quot;question-answering&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;distilbert-base-cased-distilled-squad&quot;</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>            <span class="p">)</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>            <span class="n">build_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dummy_inputs_dict</span><span class="p">)</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>                <span class="s2">&quot;IPU requirements not met on this device, skipping compilation.&quot;</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>            <span class="p">)</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>        <span class="k">return</span> <span class="n">RESULT_OK</span>
</span></code></pre></div></li>
<li>The <code>startup</code> method is called every time the server starts (when issuing <a href="../usage/#ssf-run">gc-ssf run</a>) so it can contain any warmup code we need. We instantiate and call the pipeline with dummy inputs: if the compilation cache exists, this first call will have the effect of attaching the model to available IPUs. If not, it will compile it first.
Since the lifespan of <code>self.question_answerer</code> is the same as <code>MyApplication</code>, the model will stay attached to the IPUs as long as the <code>MyApplication</code> instance is alive.
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>    <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;App started&quot;</span><span class="p">)</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">question_answerer</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>            <span class="s2">&quot;question-answering&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;distilbert-base-cased-distilled-squad&quot;</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>        <span class="p">)</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">question_answerer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dummy_inputs_dict</span><span class="p">)</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>        <span class="k">return</span> <span class="n">RESULT_OK</span>
</span></code></pre></div></li>
<li>The <code>request</code> method is the function executed by our API call. It is important to understand what will be in the dictionaries <code>params</code>(the inputs) and <code>return</code>(the output) as SSF will use it later to generate the API.
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>    <span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">meta</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">question_answerer</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>        <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></li>
<li>
<p>Any resource freeing can be carried out in the <code>shutdown</code> method. We have left it empty:
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>    <span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>        <span class="k">return</span> <span class="n">RESULT_OK</span>
</span></code></pre></div></p>
</li>
<li>
<p>Finally, <code>is_healthy</code> will be called periodically by our server. If it fails, the server will try to kill and restart <code>MyApplication</code>.
As an example we verify that we get an expected output from a known input:
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>    <span class="k">def</span> <span class="nf">is_healthy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">question_answerer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dummy_inputs_dict</span><span class="p">)</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Rob&quot;</span>
</span></code></pre></div></p>
</li>
</ul>
<h2 id="write-ssf-config">Write SSF config</h2>
<p>The SSF config is the point of contact between our application and SSF. This will define all the metadata, the requirements (such as Python libraries needed for our application, the base Docker image to use, and so on), and also define our API.</p>
<p>The SSF config folder can be considered the primary application folder or context. All files and modules should be specified relative to the SSF config folder.
The current working directory will be set to the application module folder before SSF calls any of the application entry points (<code>build</code> or <code>request</code> etc.).</p>
<p>Let's create <code>ssf_config.yaml</code> :
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># Copyright (c) 2023 Graphcore Ltd. All rights reserved.</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="nt">ssf_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0.0</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="nt">application</span><span class="p">:</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qa_api</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Question Answering API</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">  </span><span class="nt">desc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">A very simple QA API</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">  </span><span class="nt">module</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_app.py</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">  </span><span class="nt">ipus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">  </span><span class="nt">trace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w">  </span><span class="nt">dependencies</span><span class="p">:</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="w">    </span><span class="nt">python</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">git+https://github.com/huggingface/optimum-graphcore.git@97c11c3</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="w">  </span><span class="nt">package</span><span class="p">:</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="w">    </span><span class="nt">inclusions</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">exe_cache/</span><span class="p p-Indicator">]</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="w">    </span><span class="nt">exclusions</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="w">    </span><span class="nt">docker</span><span class="p">:</span>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="w">        </span><span class="nt">baseimage</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;graphcore/pytorch:latest&quot;</span>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="nt">endpoints</span><span class="p">:</span>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">QA</span>
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="w">    </span><span class="nt">desc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Question answering model</span>
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="w">    </span><span class="nt">custom</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">~</span>
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="w">    </span><span class="nt">inputs</span><span class="p">:</span>
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">context</span>
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">String</span>
</span><span id="__span-8-33"><a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a><span class="w">        </span><span class="nt">desc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Context</span>
</span><span id="__span-8-34"><a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a>
</span><span id="__span-8-35"><a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">question</span>
</span><span id="__span-8-36"><a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">String</span>
</span><span id="__span-8-37"><a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a><span class="w">        </span><span class="nt">desc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Question</span>
</span><span id="__span-8-38"><a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a>
</span><span id="__span-8-39"><a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a><span class="w">    </span><span class="nt">outputs</span><span class="p">:</span>
</span><span id="__span-8-40"><a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a>
</span><span id="__span-8-41"><a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">answer</span>
</span><span id="__span-8-42"><a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">String</span>
</span><span id="__span-8-43"><a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a><span class="w">        </span><span class="nt">desc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Answer in the text</span>
</span><span id="__span-8-44"><a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a>
</span><span id="__span-8-45"><a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">score</span>
</span><span id="__span-8-46"><a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Float</span>
</span><span id="__span-8-47"><a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a><span class="w">        </span><span class="nt">desc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Probability score</span>
</span></code></pre></div></p>
<p>Now let's explain the main lines:</p>
<ul>
<li>
<p>Under <code>application</code>:<br />
<code>module</code> tells us where to find the interface that we have implemented:
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>module: my_app.py
</span></code></pre></div>
Since we are using IPUs, let's check the resources used. The <a href="https://huggingface.co/Graphcore/distilbert-base-ipu/blob/main/ipu_config.json">distillbert-base IPU config</a> indicates 2 IPUs. With this config line, SSF will verify the system can acquire 2 IPUs when running the command <a href="../usage/#ssf-run"><code>run</code></a> or <a href="../usage/#ssf-test"><code>test</code></a>.
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>ipus: 2
</span></code></pre></div>
Our model needs the <code>optimum-graphcore</code> package, we can specify any <code>pip</code> packages here (as a list or a requirements file path):
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>dependencies:
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>    python: git+https://github.com/huggingface/optimum-graphcore.git
</span></code></pre></div>
The <code>package</code> section refers to the <a href="../usage/#ssf-package">gc-ssf package</a> command, we can edit how we want SSF to build our container.
We can include any files used by our application (and exclude some others), glob patterns are supported. Let's include the compilation cache.
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>    inclusions: [exe_cache/]
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>    exclusions: []
</span></code></pre></div>
Finally we want to use Graphcore's base image with pre-installed PyTorch, so we can run <code>optimum-graphcore</code> without issue:
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>docker:
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>        baseimage: &quot;graphcore/pytorch:latest&quot;
</span></code></pre></div></p>
</li>
<li>
<p>Under <code>endpoints</code>:<br />
This is how SSF will generate our API.
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>id: QA
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>    version: 1
</span></code></pre></div>
This endpoint path will be <code>v1/QA</code>.
Now let's remember our application <code>request(self, params: dict, meta: dict)</code> method.
We want to describe here the <code>inputs</code> dictionaries using the names of the keys (<code>context</code>, <code>question</code>) and <a href="../model_format/#ssf-types">ssf types</a>.
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>    inputs:
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>      - id: context
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>        type: String
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>        desc: A context
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>      - id: question
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>        type: String
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>        desc: The question
</span></code></pre></div>
We also want to describe the <code>outputs</code>.
Notice we are only selecting <code>answer</code> and <code>score</code> from our results as we are not interested in returning the <code>start</code> and <code>end</code> keys.
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>    outputs:
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>      - id: answer
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>        type: String
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>        desc: Answer in the text
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>      - id: score
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>        type: Float
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>        desc: Probability score
</span></code></pre></div></p>
</li>
</ul>
<p>Our application is officially ready! <img alt="âœ¨" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@14.1.2/assets/svg/2728.svg" title=":sparkles:" /><br />
Now let's see what SSF can do.</p>
<h2 id="use-ssf">Use SSF</h2>
<p>We should now have the following file structure:
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>project_directory/
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>    - ssf_config.yaml
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>    - my_app.py
</span></code></pre></div>
We can use the SSF <a href="../usage/#cli-usage">commands</a> for several different scenarios. First
we should decide which commands we want to run locally (on our current machine) and which commands will run on the remote (deployment) machine.</p>
<p>Let's look at a couple of examples.</p>
<h3 id="example-1">Example 1</h3>
<p>In this first example we build our server locally and deploy its image via Docker Hub.
The workflow can be summarised as follows:
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>(local)-&gt; init, build, package, publish, deploy
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>(remote)-&gt; run
</span></code></pre></div></p>
<ul>
<li>The <code>init</code> and <code>build</code> steps are run locally, to compile the model before packaging.</li>
<li>The <code>package</code> step creates the container image locally, and <code>publish</code> pushes it to Docker Hub.</li>
<li>Finally <code>deploy</code> sends and executes the deployment script on our deployment target.
In the previous step, the container image was packaged in such a way to ensure it executes <code>run</code> when started on the remote machine.</li>
</ul>
<p>Let's build our container:
We use <code>--package-tag</code> to replace the tag from the config with our Docker username since we will push the image to Docker hub.
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>gc-ssf<span class="w"> </span>init<span class="w"> </span>build<span class="w"> </span>package<span class="w"> </span>--config<span class="w"> </span>ssf_config.yaml<span class="w"> </span>--package-tag<span class="w"> </span>&lt;docker-username&gt;/&lt;repo-name&gt;
</span></code></pre></div>
The output should look like this:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:10,773<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>&gt;<span class="w"> </span>Config<span class="w"> </span>ssf_config.yaml<span class="w"> </span><span class="o">(</span>cli.py:453<span class="o">)</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:10,778<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>WARNING<span class="w">   </span>startup_timeout<span class="w"> </span>not<span class="w"> </span>specified<span class="w"> </span><span class="k">in</span><span class="w"> </span>application.<span class="w"> </span>Defaulting<span class="w"> </span>to<span class="w"> </span>None<span class="w"> </span><span class="o">(</span>load_config.py:287<span class="o">)</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:10,778<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>WARNING<span class="w">   </span>max_batch_size<span class="w"> </span>not<span class="w"> </span>specified<span class="w"> </span><span class="k">in</span><span class="w"> </span>application.<span class="w"> </span>Defaulting<span class="w"> </span>to<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">(</span>load_config.py:287<span class="o">)</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:10,778<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>WARNING<span class="w">   </span>name<span class="w"> </span>not<span class="w"> </span>specified<span class="w"> </span><span class="k">in</span><span class="w"> </span>application.package.<span class="w"> </span>Defaulting<span class="w"> </span>to<span class="w"> </span>Question<span class="w"> </span>answering<span class="w"> </span>API-1.0.tar.gz<span class="w"> </span><span class="o">(</span>load_config.py:287<span class="o">)</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:10,778<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>WARNING<span class="w">   </span>run<span class="w"> </span>not<span class="w"> </span>specified<span class="w"> </span><span class="k">in</span><span class="w"> </span>application.package.docker.<span class="w"> </span>Defaulting<span class="w"> </span>to<span class="w">  </span><span class="o">(</span>load_config.py:287<span class="o">)</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:10,779<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>&gt;<span class="w"> </span><span class="o">====</span><span class="w"> </span><span class="nv">Init</span><span class="w"> </span><span class="o">====</span><span class="w"> </span><span class="o">(</span>init.py:17<span class="o">)</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:10,779<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>&gt;<span class="w"> </span>Cleaning_endpoints<span class="w"> </span><span class="o">(</span>init.py:19<span class="o">)</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:10,779<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>&gt;<span class="w"> </span>Clean<span class="w"> </span>application<span class="w"> </span><span class="o">(</span>init.py:22<span class="o">)</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:10,779<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>&gt;<span class="w"> </span><span class="o">====</span><span class="w"> </span><span class="nv">Build</span><span class="w"> </span><span class="o">====</span><span class="w"> </span><span class="o">(</span>build.py:25<span class="o">)</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:10,779<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>&gt;<span class="w"> </span>Generate_endpoints<span class="w"> </span><span class="o">(</span>build.py:39<span class="o">)</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:10,782<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>&gt;<span class="w"> </span>Load<span class="w"> </span>application<span class="w"> </span><span class="o">(</span>build.py:42<span class="o">)</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:10,782<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>Creating<span class="w"> </span>application<span class="w"> </span>interface<span class="w"> </span><span class="o">(</span>application.py:111<span class="o">)</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:10,782<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>Checking<span class="w"> </span>application<span class="w"> </span>dependencies<span class="w"> </span><span class="o">(</span>application.py:112<span class="o">)</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:10,782<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>installing<span class="w"> </span>python<span class="w"> </span>packages<span class="w"> </span>git+https://github.com/huggingface/optimum-graphcore.git<span class="w"> </span><span class="o">(</span>utils.py:139<span class="o">)</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:18,980<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>Loading<span class="w"> </span>Question<span class="w"> </span>answering<span class="w"> </span>API<span class="w"> </span>application<span class="w"> </span>from<span class="w"> </span>/home/repos/simple-server-framework/examples/walkthrough/my_app.py<span class="w"> </span>with<span class="w"> </span>module<span class="w"> </span>id<span class="w"> </span>Question<span class="w"> </span>answering<span class="w"> </span>API<span class="w"> </span><span class="o">(</span>application.py:119<span class="o">)</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:18,981<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>loading<span class="w"> </span>module<span class="w"> </span>/home/repos/simple-server-framework/examples/walkthrough/my_app.py<span class="w"> </span>with<span class="w"> </span>module<span class="w"> </span>name<span class="w"> </span>Question<span class="w"> </span>answering<span class="w"> </span>API<span class="w"> </span><span class="o">(</span>utils.py:161<span class="o">)</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="o">[</span>...<span class="o">]</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:25,540<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span><span class="nv">instance</span><span class="o">=</span>&lt;Question<span class="w"> </span>answering<span class="w"> </span>API.MyApplication<span class="w"> </span>object<span class="w"> </span>at<span class="w"> </span>0x7f35c0027c70&gt;<span class="w"> </span><span class="o">(</span>build.py:45<span class="o">)</span>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:25,540<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>&gt;<span class="w"> </span>Build<span class="w"> </span>application<span class="w"> </span><span class="o">(</span>build.py:47<span class="o">)</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:25,540<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>Compiling<span class="w"> </span>model...<span class="w"> </span><span class="o">(</span>my_app.py:17<span class="o">)</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a>Graph<span class="w"> </span>compilation:<span class="w"> </span><span class="m">100</span>%<span class="p">|</span>â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ<span class="p">|</span><span class="w"> </span><span class="m">100</span>/100<span class="w"> </span><span class="o">[</span><span class="m">00</span>:01&lt;<span class="m">00</span>:00<span class="o">]</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:32,930<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>&gt;<span class="w"> </span><span class="o">====</span><span class="w"> </span><span class="nv">Package</span><span class="w"> </span><span class="o">====</span><span class="w"> </span><span class="o">(</span>package.py:43<span class="o">)</span>
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:32,930<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>&gt;<span class="w"> </span>Packaging<span class="w"> </span>Question<span class="w"> </span>answering<span class="w"> </span>API<span class="w"> </span>to<span class="w"> </span>/home/repos/simple-server-framework/examples/walkthrough/.package/Question<span class="w"> </span>answering<span class="w"> </span>API<span class="w"> </span><span class="o">(</span>package.py:66<span class="o">)</span>
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:32,930<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>&gt;<span class="w"> </span>Package<span class="w"> </span>name<span class="w"> </span>Question<span class="w"> </span>answering<span class="w"> </span>API-1.0.tar.gz<span class="w"> </span><span class="o">(</span>package.py:67<span class="o">)</span>
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:32,930<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>&gt;<span class="w"> </span>Package<span class="w"> </span>tag<span class="w"> </span>deployment-test:latest<span class="w"> </span><span class="o">(</span>package.py:68<span class="o">)</span>
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:32,931<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>&gt;<span class="w"> </span>Package<span class="w"> </span>SSF<span class="w"> </span>from<span class="w"> </span>/home/repos/simple-server-framework/ssf<span class="w"> </span><span class="o">(</span>package.py:99<span class="o">)</span>
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:32,941<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>&gt;<span class="w"> </span>Package<span class="w"> </span>Application<span class="w"> </span>from<span class="w"> </span>/home/repos/simple-server-framework/examples/walkthrough<span class="w"> </span><span class="o">(</span>package.py:136<span class="o">)</span>
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:32,942<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>&gt;<span class="w"> </span>Package<span class="w"> </span>Endpoint<span class="w"> </span>files<span class="w"> </span><span class="o">(</span>package.py:150<span class="o">)</span>
</span><span id="__span-20-30"><a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:32,943<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>&gt;<span class="w"> </span>Gathering<span class="w"> </span>pip<span class="w"> </span>requirements<span class="w"> </span><span class="o">(</span>package.py:169<span class="o">)</span>
</span><span id="__span-20-31"><a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:52:32,943<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>&gt;<span class="w"> </span>Generate<span class="w"> </span>container<span class="w"> </span>image<span class="w"> </span><span class="o">(</span>package.py:211<span class="o">)</span>
</span><span id="__span-20-32"><a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a>
</span><span id="__span-20-33"><a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a><span class="o">[</span>...<span class="o">]</span>
</span><span id="__span-20-34"><a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:53:34,043<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>&gt;<span class="w"> </span>Package:<span class="w"> </span><span class="o">(</span>package.py:245<span class="o">)</span>
</span><span id="__span-20-35"><a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:53:34,043<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>&gt;<span class="w"> </span>Question<span class="w"> </span>answering<span class="w"> </span>API-1.0.tar.gz<span class="w"> </span><span class="o">(</span>from<span class="w"> </span>/home/repos/simple-server-framework/examples/walkthrough/.package/Question<span class="w"> </span>answering<span class="w"> </span>API/src<span class="o">)</span><span class="w"> </span><span class="o">(</span>package.py:246<span class="o">)</span>
</span><span id="__span-20-36"><a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:53:34,043<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>&gt;<span class="w"> </span>Test<span class="w"> </span>run:<span class="w"> </span><span class="s1">&#39;cd /home/repos/simple-server-framework/examples/walkthrough/.package/Question answering API/src &amp;&amp; ./run.sh&#39;</span><span class="w"> </span><span class="o">(</span>package.py:247<span class="o">)</span>
</span><span id="__span-20-37"><a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:53:34,043<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>&gt;<span class="w"> </span>Docker:<span class="w"> </span><span class="o">(</span>package.py:249<span class="o">)</span>
</span><span id="__span-20-38"><a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:53:34,043<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>&gt;<span class="w"> </span>Run:<span class="w"> </span><span class="s1">&#39;docker run --rm -d --network host --name Question answering API deployment-test:latest&#39;</span><span class="w"> </span><span class="o">(</span>package.py:250<span class="o">)</span>
</span><span id="__span-20-39"><a id="__codelineno-20-39" name="__codelineno-20-39" href="#__codelineno-20-39"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:53:34,043<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>&gt;<span class="w"> </span>Run<span class="w"> </span>with<span class="w"> </span>IPU<span class="w"> </span>devices:<span class="w"> </span><span class="s1">&#39;gc-docker -- --rm -d  --name Question answering API deployment-test:latest&#39;</span><span class="w"> </span><span class="o">(</span>package.py:253<span class="o">)</span>
</span><span id="__span-20-40"><a id="__codelineno-20-40" name="__codelineno-20-40" href="#__codelineno-20-40"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:53:34,043<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>&gt;<span class="w"> </span>Logs:<span class="w"> </span><span class="s1">&#39;docker logs -f Question answering API&#39;</span><span class="w"> </span><span class="o">(</span>package.py:257<span class="o">)</span>
</span><span id="__span-20-41"><a id="__codelineno-20-41" name="__codelineno-20-41" href="#__codelineno-20-41"></a><span class="m">2023</span>-05-30<span class="w"> </span><span class="m">17</span>:53:34,043<span class="w"> </span><span class="m">1009745</span><span class="w">    </span>INFO<span class="w">      </span>&gt;<span class="w"> </span>Stop:<span class="w"> </span><span class="s1">&#39;docker stop Question answering API&#39;</span><span class="w"> </span><span class="o">(</span>package.py:258<span class="o">)</span>
</span></code></pre></div>
You should be able to see that a new <code>.package/</code> directory has been created, it contains the bundled server.
We can also verify that our server image was created during the package step with docker:
<div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>docker images
</span></code></pre></div>
For the next step, a login to a Docker Hub registry is necessary.
SSF will log in temporarily to Docker when using <code>--docker-username</code> and <code>--docker-password</code> options.
But if you are already logged in with the correct account, you don't need these options for this step.</p>
<p>We can now publish our image on Docker hub.<br />
Let's specify that we will push it with the same tag as during the package step using <code>--package-tag</code>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>gc-ssf<span class="w"> </span>publish<span class="w"> </span>--config<span class="w"> </span>ssf_config.yaml<span class="w"> </span>--package-tag<span class="w"> </span>&lt;docker-username&gt;/&lt;repo-name&gt;<span class="w"> </span>--docker-username<span class="w"> </span>&lt;docker-username&gt;<span class="w"> </span>--docker-password<span class="w"> </span>&lt;token&gt;
</span></code></pre></div>
Finally, deploy the container to Gcore.
We will consider that we have set up a VM with at least 2 IPUs with the IP address 123.456.789.0 and the default username "ubuntu".
To access it, we have a private key. SSF will need this to access the VM and deploy. To pass the key securely we will store it in an <code>env</code> variable and use the option <code>--add-ssh-key</code>. For instance we can set it from a file:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="nv">SSH_KEY</span><span class="o">=</span><span class="k">$(</span>cat<span class="w"> </span>ssh_key_file<span class="k">)</span><span class="w">  </span>gc-ssf<span class="w"> </span>--add-ssh-key<span class="w"> </span>SSH_KEY
</span></code></pre></div>
Now let's run the <code>deploy</code> command with the following set of options. We also pass our Docker token via the option <code>--docker-password</code> which is needed to pull the image from our Docker hub repo to the remote VM (but this is not needed if you use a public repo).
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>gc-ssf<span class="w"> </span>deploy<span class="w"> </span>--config<span class="w"> </span>ssf_config.yaml<span class="w"> </span>--deploy-platform<span class="w"> </span>Gcore<span class="w"> </span>--port<span class="w"> </span><span class="m">8100</span><span class="w"> </span>--deploy-gcore-target-address<span class="w"> </span><span class="m">123</span>.456.789.0<span class="w"> </span>--deploy-gcore-target-username<span class="w"> </span>ubuntu<span class="w"> </span>--docker-username<span class="w"> </span>&lt;docker-username&gt;<span class="w"> </span>--docker-password<span class="w"> </span>&lt;token&gt;<span class="w"> </span>--package-tag<span class="w"> </span>&lt;username&gt;/&lt;repo-name&gt;:latest<span class="w"> </span>--deploy-package
</span></code></pre></div>
* Notice the use of <code>--deploy-packaged</code> to specify that we want to deploy from the package that we published previously.</p>
<p>With this configuration our API endpoint should be available at<br />
<code>http://123.456.789.0:8100/v1/QA.</code><br />
Since it's using FastAPI you can also test it with Swagger UI under the path <code>http://123.456.789.0:8100/docs</code>.<br />
Under the hood, the <code>deploy</code> command will simply run a script on the Gcore VM to pull our custom image from Docker Hub, build and run it. The container entry point will issue the command <code>run</code>.</p>
<p>The following diagram summarises the operations of this first example.
<img alt="workflow1" src="../img/workflow_build.png" /></p>
<h3 id="example-2">Example 2</h3>
<p>Sometimes our local environment doesn't allow us to build containers, or we just want to experiment quickly.
In this second example we won't build any container image.
This means that the following workflow is possible:
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>(local)-&gt; deploy
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>(remote)-&gt; init, build, run
</span></code></pre></div>
This is made possible by storing our model in a repository and using a <a href="https://hub.docker.com/r/graphcore/simple-server-framework">pre-built SSF image</a>.
First we need to set up a remote repository for our model. For example, using a GitHub account we could do:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="w">  </span><span class="nb">cd</span><span class="w"> </span>project_directory<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>git<span class="w"> </span>init
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">  </span>git<span class="w"> </span>add<span class="w"> </span>-A
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">  </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;First commit&#39;</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w">  </span>git<span class="w"> </span>remote<span class="w"> </span>add<span class="w"> </span>origin<span class="w"> </span>git@github.com:your-username/project_directory.git
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="w">  </span>git<span class="w"> </span>push<span class="w"> </span>-u<span class="w"> </span>-f<span class="w"> </span>origin<span class="w"> </span>main
</span></code></pre></div>
To register the VM SSH key locally we could do:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="nv">SSH_KEY</span><span class="o">=</span><span class="k">$(</span>cat<span class="w"> </span>ssh_key_file<span class="k">)</span><span class="w">  </span>gc-ssf<span class="w"> </span>--add-ssh-key<span class="w"> </span>SSH_KEY
</span></code></pre></div></p>
<p>If you use a private repo, you will also need to allow your VM to clone from it.
To do that you will need to generate a GitHub deploy-key for your repo (or an equivalent access-limited SSH key).
Then, pass it with the <code>deploy</code> command using an env variable (for example <code>MY_DEPLOY_KEY</code>) and <code>--add-ssh-key</code>.</p>
<p>Now let's use <code>deploy</code> targeting our git repo:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="nv">MY_DEPLOY_KEY</span><span class="o">=</span><span class="k">$(</span>cat<span class="w"> </span>github_deploy_key<span class="k">)</span><span class="w"> </span>gc-ssf<span class="w"> </span>deploy<span class="w"> </span>--config<span class="w"> </span><span class="s1">&#39;git@github.com:your-username/project_directory.git|ssf_config.yaml&#39;</span><span class="w"> </span>--port<span class="w"> </span><span class="m">8100</span><span class="w">  </span>--deploy-platform<span class="w"> </span>Gcore<span class="w"> </span>--deploy-gcore-target-address<span class="w"> </span><span class="m">123</span>.456.789.0<span class="w"> </span>--deploy-gcore-target-username<span class="w"> </span>ubuntu<span class="w"> </span>--add-ssh-key<span class="w"> </span>MY_DEPLOY_KEY
</span></code></pre></div></p>
<ul>
<li>Notice this time we are not using <code>--deploy-packaged</code>, so SSF will deploy from the default public image. <code>gc-ssf --help</code> can be used to see the default SSF image used for deployment.
Under the hood the <code>deploy</code> command will send and run a script on the Gcore VM. That will pull the <a href="https://hub.docker.com/r/graphcore/simple-server-framework">public SSF image</a> from Docker Hub, build and run it. The container entry point will clone our repo and issue the three commands <code>init build run</code>.</li>
</ul>
<p>As in the first example, our API endpoint should be available at<br />
<code>http://123.456.789.0:8100/v1/QA</code>.<br />
You can also test it with Swagger UI under the path <code>http://123.456.789.0:8100/docs</code>.</p>
<p>The following diagram summarises the operations of this second example.
<img alt="workflow1" src="../img/workflows_online.png" /></p>
<p>Note that we only deployed a Docker container on a Gcore VM.<br />
You can still SSH normally into your VM and use the usual Docker commands, for example <code>docker container ls</code>, <code>docker log...</code>, <code>docker stop ...</code>.</p>
<h2 id="discussion-example-1-vs-example-2">Discussion: Example 1 vs Example 2</h2>
<p>These examples have shown two different ways to deploy on the Gcore platform with SSF.
Both are serving your application with the same API, but it's important to underline their differences.</p>
<h3 id="example-1-gives-you-more-control">Example 1 gives you more control:</h3>
<p>By packaging your app in advance with SSF, you create your own custom Docker image. Then you can version your images via Docker hub.
This method can also have runtime advantages. By building and packaging some runtime-generated files in advance (such as IPUs pre-compiled executables) you can save some precious server startup time.</p>
<h3 id="example-2-is-quicker-but-can-have-some-runtime-impact">Example 2 is quicker but can have some runtime impact:</h3>
<p>By deploying your model with the default public image, you don't need to run Docker locally or worry about the packaging step, and your model can be versioned via git.
The server startup time might be impacted since the application <code>build</code> step will be triggered in the deployment environment before the server startup.  Of course, you can still include cached files as part of the model repository. But depending on the size of the files you might prefer to package your app in advance and follow Example 1, for instance if you have a very large model to compile.</p>






              </article>
            </div>


        </div>

      </main>

        <footer class="md-footer">

  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">


    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>

</div>

    </div>
  </div>
</footer>

    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>

    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.select", "content.code.copy"], "search": "../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>


      <script src="../assets/javascripts/bundle.220ee61c.min.js"></script>


  </body>
</html>
